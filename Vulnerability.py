import nmap

class VulnerabilityScanner:
    def __init__(self, target_ip):
        self.scanner = nmap.PortScanner()
        self.target_ip = target_ip

    def scan(self):
        print(f'Scanning {self.target_ip}...')
        self.scanner.scan(self.target_ip)

        print('Running vulnerability scans...')
        self.scanner.scan(self.target_ip, arguments='--script vuln')

        self.display_results()

    def display_results(self):
        if self.scanner.all_hosts():
            for host in self.scanner.all_hosts():
                print(f'\nHost: {host} ({self.scanner[host].hostname()})')
                print(f'State: {self.scanner[host].state()}')
                for proto in self.scanner[host].all_protocols():
                    print(f'\nProtocol: {proto}')
                    lport = self.scanner[host][proto].keys()
                    for port in sorted(lport):
                        state = self.scanner[host][proto][port]['state']
                        print(f'Port: {port}\tState: {state}')
                
                # Display vulnerabilities found
                if 'hostscript' in self.scanner[host]:
                    print('\nVulnerabilities:')
                    for script in self.scanner[host]['hostscript']:
                        print(f"  - {script['id']}: {script['output']}")
        else:
            print('No hosts found.')

# Example usage
if __name__ == "__main__":
    target = '192.168.29.1'  # Replace with the target IP
    scanner = VulnerabilityScanner(target)
    scanner.scan()